name: PR Check (Non-Production)

on:
  pull_request:
    # 任意のブランチへのPRで実行（main, develop, feature/*, など全て）
  push:
    branches: [ feature/* ]                 # feature ブランチへのプッシュでも実行
    branches-ignore: [ main ]               # mainブランチは除外（Pages用ワークフローに任せる）
  workflow_dispatch:                        # 手動実行も可能

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: npm install --no-package-lock || echo "No package.json found, skipping npm install"
    
    - name: Lint HTML files
      run: |
        echo "Checking HTML files..."
        find . -name "*.html" -type f | head -5
    
    - name: Lint JavaScript files
      run: |
        echo "Checking JavaScript files..."
        find . -name "*.js" -type f | head -5
    
    - name: Check file structure
      run: |
        echo "Project structure:"
        ls -la
        echo "JavaScript files:"
        find . -name "*.js" -not -path "./node_modules/*" | head -10
    
    - name: Validate JavaScript syntax
      run: |
        echo "Validating JavaScript syntax..."
        for file in $(find . -name "*.js" -not -path "./node_modules/*"); do
          echo "Checking $file"
          node -c "$file" || echo "Syntax error in $file"
        done