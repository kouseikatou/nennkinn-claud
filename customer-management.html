<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>顧客管理 - 障害年金管理システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif']
                    },
                    colors: {
                        'notion-gray': {
                            50: '#fbfbfa',
                            100: '#f7f6f3',
                            200: '#e9e7e3',
                            300: '#d9d5ce',
                            400: '#b8b2a7',
                            500: '#a49c8c',
                            600: '#8d8371',
                            700: '#6f6652',
                            800: '#565043',
                            900: '#373530'
                        },
                        'linear-blue': {
                            50: '#eff6ff',
                            100: '#dbeafe', 
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a'
                        },
                        'saas': {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            400: '#9ca3af',
                            500: '#6b7280',
                            700: '#374151'
                        },
                        'primary': {
                            50: '#eff6ff',
                            200: '#bfdbfe',
                            600: '#2563eb',
                            700: '#1d4ed8'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-notion-gray-50 font-sans">
    <!-- ヘッダー -->
    <header class="bg-white border-b border-notion-gray-200 px-8 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="w-8 h-8 bg-linear-blue-600 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                        <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-lg font-semibold text-notion-gray-800">障害年金管理システム</h1>
                </div>
            </div>
        </div>
    </header>

    <div class="flex min-h-screen w-full">
        <!-- Sidebar -->
        <div class="w-64 bg-white border-r border-saas-200 shadow-sm min-h-screen">
            <nav class="p-6">
                <div class="mb-8">
                    <ul class="space-y-2">
                        <li>
                            <a href="index.html" class="group flex items-center px-3 py-2.5 text-sm font-medium rounded-xl text-saas-700 hover:bg-saas-50 hover:text-saas-700 transition-all duration-200">
                                <div class="mr-3 flex-shrink-0">
                                    <svg class="h-5 w-5 text-saas-500 group-hover:text-saas-700" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                    </svg>
                                </div>
                                ダッシュボード
                            </a>
                        </li>
                        <li>
                            <a href="customer-management.html" class="group flex items-center px-3 py-2.5 text-sm font-medium rounded-xl bg-primary-50 text-primary-700 border border-primary-200">
                                <div class="mr-3 flex-shrink-0">
                                    <svg class="h-5 w-5 text-primary-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M13 6a3 3 0 11-6 0 3 3 0 616 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 713.75-2.906z"/>
                                    </svg>
                                </div>
                                顧客管理
                            </a>
                        </li>
                        <li>
                            <a href="projects.html" class="group flex items-center px-3 py-2.5 text-sm font-medium rounded-xl text-saas-700 hover:bg-saas-50 hover:text-saas-700 transition-all duration-200">
                                <div class="mr-3 flex-shrink-0">
                                    <svg class="h-5 w-5 text-saas-500 group-hover:text-saas-700" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 3a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                申請管理
                            </a>
                        </li>
                        <li>
                            <a href="document-creation.html" class="group flex items-center px-3 py-2.5 text-sm font-medium rounded-xl text-saas-700 hover:bg-saas-50 hover:text-saas-700 transition-all duration-200">
                                <div class="mr-3 flex-shrink-0">
                                    <svg class="h-5 w-5 text-saas-500 group-hover:text-saas-700" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm3 5a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm0 3a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1z" clip-rule="evenodd"/>
                                        <path d="M14 9a1 1 0 011 1v2a1 1 0 11-2 0v-2a1 1 0 011-1z"/>
                                    </svg>
                                </div>
                                書類作成
                            </a>
                        </li>
                        <li>
                            <a href="ai-statement.html" class="group flex items-center px-3 py-2.5 text-sm font-medium rounded-xl text-saas-700 hover:bg-saas-50 hover:text-saas-700 transition-all duration-200">
                                <div class="mr-3 flex-shrink-0">
                                    <svg class="h-5 w-5 text-saas-500 group-hover:text-saas-700" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                AI申立書
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <main class="flex-1 p-6 bg-notion-gray-50">
            <div class="max-w-7xl mx-auto">
                <!-- タイトル -->
                <div class="mb-8">
                    <h2 class="text-2xl font-semibold text-notion-gray-800 mb-2">顧客管理</h2>
                    <p class="text-notion-gray-600">申請者の一元管理</p>
                </div>

                <!-- 検索・フィルター -->
                <div class="mb-6 flex flex-col sm:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="customerSearch" placeholder="顧客名やIDで検索..." class="w-full px-4 py-2 border border-notion-gray-300 rounded-lg focus:ring-2 focus:ring-linear-blue-500 focus:border-transparent outline-none bg-white" onkeyup="filterCustomers()">
                    </div>
                    <div class="flex gap-2">
                        <select id="statusFilter" class="px-3 py-2 border border-notion-gray-300 rounded-lg focus:ring-2 focus:ring-linear-blue-500 focus:border-transparent outline-none bg-white" onchange="filterCustomers()">
                            <option value="">全てのステータス</option>
                            <option value="active">進行中</option>
                            <option value="completed">完了</option>
                            <option value="pending">保留</option>
                        </select>
                        <button onclick="openAddCustomerModal()" class="px-4 py-2 bg-linear-blue-600 text-white rounded-lg hover:bg-linear-blue-700 transition-all duration-200">
                            新規顧客追加
                        </button>
                    </div>
                </div>

                <!-- 顧客一覧 -->
                <div class="bg-white rounded-xl border border-notion-gray-200 overflow-hidden shadow-sm">
                    <div class="px-6 py-4 border-b border-notion-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-notion-gray-800">顧客一覧</h3>
                            <span id="customerCount" class="text-sm text-notion-gray-500">0 件の顧客</span>
                        </div>
                    </div>
                    <div id="customerList" class="divide-y divide-notion-gray-100">
                        <!-- 顧客リストはJavaScriptで動的に生成 -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 新規顧客追加モーダル -->
    <div id="addCustomerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl border border-notion-gray-200 w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
            <div class="px-6 py-4 border-b border-notion-gray-200 flex items-center justify-between">
                <h3 class="text-lg font-semibold text-notion-gray-800">新規顧客追加</h3>
                <button onclick="closeAddCustomerModal()" class="text-notion-gray-400 hover:text-notion-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <form id="addCustomerForm">
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-notion-gray-700 mb-2">姓名 *</label>
                                <input type="text" id="customerName" required class="w-full px-4 py-3 border border-notion-gray-300 rounded-lg focus:ring-2 focus:ring-linear-blue-500 focus:border-transparent outline-none" placeholder="例：田中太郎">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-notion-gray-700 mb-2">電話番号 *</label>
                                <input type="tel" id="customerPhone" required class="w-full px-4 py-3 border border-notion-gray-300 rounded-lg focus:ring-2 focus:ring-linear-blue-500 focus:border-transparent outline-none" placeholder="例：090-1234-5678">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-notion-gray-700 mb-2">メールアドレス</label>
                            <input type="email" id="customerEmail" class="w-full px-4 py-3 border border-notion-gray-300 rounded-lg focus:ring-2 focus:ring-linear-blue-500 focus:border-transparent outline-none" placeholder="例：tanaka@example.com">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-notion-gray-700 mb-2">住所</label>
                            <textarea id="customerAddress" class="w-full px-4 py-3 border border-notion-gray-300 rounded-lg focus:ring-2 focus:ring-linear-blue-500 focus:border-transparent outline-none h-24" placeholder="例：東京都新宿区..."></textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-notion-gray-700 mb-2">生年月日</label>
                                <input type="date" id="customerBirthdate" class="w-full px-4 py-3 border border-notion-gray-300 rounded-lg focus:ring-2 focus:ring-linear-blue-500 focus:border-transparent outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-notion-gray-700 mb-2">障害の種類</label>
                                <select id="customerDisabilityType" class="w-full px-4 py-3 border border-notion-gray-300 rounded-lg focus:ring-2 focus:ring-linear-blue-500 focus:border-transparent outline-none">
                                    <option value="">選択してください</option>
                                    <option value="mental">精神の障害</option>
                                    <option value="physical">肢体の障害</option>
                                    <option value="visual">眼の障害</option>
                                    <option value="hearing">聴覚・言語機能の障害</option>
                                    <option value="respiratory">呼吸器疾患の障害</option>
                                    <option value="circulatory">循環器疾患の障害</option>
                                    <option value="kidney">腎疾患・肝疾患・糖尿病の障害</option>
                                    <option value="blood">血液・造血器・その他の障害</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-notion-gray-700 mb-2">備考</label>
                            <textarea id="customerNotes" class="w-full px-4 py-3 border border-notion-gray-300 rounded-lg focus:ring-2 focus:ring-linear-blue-500 focus:border-transparent outline-none h-24" placeholder="その他の特記事項があれば記入してください"></textarea>
                        </div>

                        <div class="flex justify-end space-x-4">
                            <button type="button" onclick="closeAddCustomerModal()" class="px-6 py-3 border border-notion-gray-300 text-notion-gray-700 rounded-lg hover:bg-notion-gray-50 transition-all duration-200">
                                キャンセル
                            </button>
                            <button type="submit" class="px-6 py-3 bg-linear-blue-600 text-white rounded-lg hover:bg-linear-blue-700 transition-all duration-200">
                                顧客を追加
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 顧客詳細モーダル -->
    <div id="customerDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl border border-notion-gray-200 w-full max-w-4xl mx-4 max-h-[80vh] overflow-y-auto">
            <div class="px-6 py-4 border-b border-notion-gray-200 flex items-center justify-between">
                <h3 id="customerDetailTitle" class="text-lg font-semibold text-notion-gray-800">顧客詳細</h3>
                <button onclick="closeCustomerDetailModal()" class="text-notion-gray-400 hover:text-notion-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
            <div id="customerDetailContent" class="p-6">
                <!-- 詳細内容はJavaScriptで動的に生成 -->
            </div>
        </div>
    </div>

    <script>
        // 顧客データ管理
        let customers = [
            {
                id: 'CUST-2024-001',
                name: '田中太郎',
                phone: '090-1234-5678',
                email: 'tanaka@example.com',
                address: '東京都新宿区西新宿1-1-1',
                birthdate: '1980-05-15',
                disabilityType: 'mental',
                disabilityTypeName: '精神の障害',
                status: 'active',
                statusName: '進行中',
                registrationDate: '2024-07-15',
                notes: '初回相談時から積極的な姿勢',
                documents: [
                    {
                        type: 'diagnosis',
                        typeName: '診断書（精神の障害用）',
                        date: '2024-07-26',
                        hospital: '○○総合病院',
                        doctor: '山田医師',
                        status: 'requested'
                    }
                ]
            },
            {
                id: 'CUST-2024-002',
                name: '山田花子',
                phone: '080-9876-5432',
                email: 'yamada@example.com',
                address: '神奈川県横浜市港北区新横浜2-2-2',
                birthdate: '1975-12-03',
                disabilityType: 'physical',
                disabilityTypeName: '肢体の障害',
                status: 'completed',
                statusName: '完了',
                registrationDate: '2024-06-20',
                notes: '家族のサポートが充実',
                documents: [
                    {
                        type: 'medical-certificate',
                        typeName: '受診状況等証明書',
                        date: '2024-07-24',
                        hospital: '△△クリニック',
                        doctor: '',
                        status: 'completed'
                    }
                ]
            },
            {
                id: 'CUST-2024-003',
                name: '佐藤一郎',
                phone: '070-5555-7777',
                email: '',
                address: '大阪府大阪市中央区本町3-3-3',
                birthdate: '1985-08-22',
                disabilityType: 'physical',
                disabilityTypeName: '肢体の障害',
                status: 'pending',
                statusName: '保留',
                registrationDate: '2024-07-10',
                notes: '書類の準備に時間を要している',
                documents: [
                    {
                        type: 'diagnosis',
                        typeName: '診断書（肢体の障害用）',
                        date: '2024-07-22',
                        hospital: '□□整形外科',
                        doctor: '佐藤医師',
                        status: 'in-review'
                    }
                ]
            }
        ];

        let filteredCustomers = [...customers];

        // 書類作成からの顧客データ自動記録
        function addDocumentToCustomer(customerId, documentData) {
            const customer = customers.find(c => c.id === customerId || c.name === customerId);
            if (customer) {
                if (!customer.documents) {
                    customer.documents = [];
                }
                customer.documents.push(documentData);
                renderCustomers();
            } else {
                // 新規顧客として作成
                const newCustomer = {
                    id: `CUST-2024-${String(customers.length + 1).padStart(3, '0')}`,
                    name: customerId,
                    phone: '',
                    email: '',
                    address: '',
                    birthdate: '',
                    disabilityType: '',
                    disabilityTypeName: '',
                    status: 'active',
                    statusName: '進行中',
                    registrationDate: new Date().toLocaleDateString('ja-JP'),
                    notes: '書類作成から自動追加',
                    documents: [documentData]
                };
                customers.push(newCustomer);
                filteredCustomers = [...customers];
                renderCustomers();
            }
        }

        // 顧客一覧の表示
        function renderCustomers() {
            const customerList = document.getElementById('customerList');
            const customerCount = document.getElementById('customerCount');
            
            customerCount.textContent = `${filteredCustomers.length} 件の顧客`;

            if (filteredCustomers.length === 0) {
                customerList.innerHTML = `
                    <div class="p-6">
                        <div class="text-center py-12">
                            <div class="w-16 h-16 bg-notion-gray-100 rounded-xl flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-notion-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13 6a3 3 0 11-6 0 3 3 0 616 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 713.75-2.906z"/>
                                </svg>
                            </div>
                            <h4 class="text-lg font-semibold text-notion-gray-800 mb-2">顧客が見つかりません</h4>
                            <p class="text-notion-gray-600 mb-6">検索条件を変更するか、新しい顧客を追加してください。</p>
                        </div>
                    </div>
                `;
                return;
            }

            const statusColors = {
                'active': 'bg-blue-100 text-blue-800',
                'completed': 'bg-green-100 text-green-800',
                'pending': 'bg-yellow-100 text-yellow-800'
            };

            const customerHTML = filteredCustomers.map(customer => `
                <div class="p-6 hover:bg-notion-gray-50 transition-all duration-200 cursor-pointer" onclick="openCustomerDetail('${customer.id}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-linear-blue-100 rounded-xl flex items-center justify-center">
                                <span class="text-linear-blue-600 font-semibold text-lg">${customer.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-notion-gray-800">${customer.name}</h4>
                                <p class="text-sm text-notion-gray-600">ID: ${customer.id}</p>
                                <p class="text-xs text-notion-gray-500">登録日: ${customer.registrationDate}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${statusColors[customer.status]}">
                                ${customer.statusName}
                            </span>
                            <p class="text-xs text-notion-gray-500 mt-1">書類: ${customer.documents ? customer.documents.length : 0}件</p>
                            <p class="text-xs text-notion-gray-500">${customer.disabilityTypeName || '未設定'}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            customerList.innerHTML = customerHTML;
        }

        // 顧客フィルタリング
        function filterCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            filteredCustomers = customers.filter(customer => {
                const matchesSearch = customer.name.toLowerCase().includes(searchTerm) || 
                                    customer.id.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || customer.status === statusFilter;
                
                return matchesSearch && matchesStatus;
            });

            renderCustomers();
        }

        // 新規顧客追加モーダル
        function openAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.remove('hidden');
        }

        function closeAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.add('hidden');
            document.getElementById('addCustomerForm').reset();
        }

        // 顧客詳細モーダル
        function openCustomerDetail(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;

            const modal = document.getElementById('customerDetailModal');
            const title = document.getElementById('customerDetailTitle');
            const content = document.getElementById('customerDetailContent');

            title.textContent = `${customer.name} の詳細情報`;

            const statusColors = {
                'active': 'bg-blue-100 text-blue-800',
                'completed': 'bg-green-100 text-green-800',
                'pending': 'bg-yellow-100 text-yellow-800'
            };

            content.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- 基本情報 -->
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-semibold text-notion-gray-800 mb-4">基本情報</h4>
                            <div class="bg-notion-gray-50 rounded-lg p-4 space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-notion-gray-600">顧客ID:</span>
                                    <span class="text-sm text-notion-gray-800">${customer.id}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-notion-gray-600">氏名:</span>
                                    <span class="text-sm text-notion-gray-800">${customer.name}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-notion-gray-600">電話番号:</span>
                                    <span class="text-sm text-notion-gray-800">${customer.phone || '未設定'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-notion-gray-600">メールアドレス:</span>
                                    <span class="text-sm text-notion-gray-800">${customer.email || '未設定'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-notion-gray-600">生年月日:</span>
                                    <span class="text-sm text-notion-gray-800">${customer.birthdate || '未設定'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-notion-gray-600">障害の種類:</span>
                                    <span class="text-sm text-notion-gray-800">${customer.disabilityTypeName || '未設定'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-notion-gray-600">ステータス:</span>
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${statusColors[customer.status]}">
                                        ${customer.statusName}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-notion-gray-800 mb-4">住所</h4>
                            <div class="bg-notion-gray-50 rounded-lg p-4">
                                <p class="text-sm text-notion-gray-800">${customer.address || '未設定'}</p>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-notion-gray-800 mb-4">備考</h4>
                            <div class="bg-notion-gray-50 rounded-lg p-4">
                                <p class="text-sm text-notion-gray-800">${customer.notes || '特記事項なし'}</p>
                            </div>
                        </div>
                    </div>

                    <!-- 書類履歴 -->
                    <div>
                        <h4 class="text-lg font-semibold text-notion-gray-800 mb-4">書類作成履歴</h4>
                        <div class="space-y-3">
                            ${customer.documents && customer.documents.length > 0 ? 
                                customer.documents.map(doc => {
                                    const docStatusColors = {
                                        'requested': 'bg-orange-100 text-orange-800',
                                        'in-review': 'bg-yellow-100 text-yellow-800',
                                        'completed': 'bg-green-100 text-green-800'
                                    };
                                    return `
                                        <div class="bg-white border border-notion-gray-200 rounded-lg p-4">
                                            <div class="flex items-center justify-between mb-2">
                                                <h5 class="text-sm font-medium text-notion-gray-800">${doc.typeName}</h5>
                                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${docStatusColors[doc.status]}">
                                                    ${doc.status === 'requested' ? '作成依頼中' : 
                                                      doc.status === 'in-review' ? '医師確認中' : '取得完了'}
                                                </span>
                                            </div>
                                            <p class="text-xs text-notion-gray-600">作成日: ${doc.date}</p>
                                            <p class="text-xs text-notion-gray-600">医療機関: ${doc.hospital}</p>
                                            ${doc.doctor ? `<p class="text-xs text-notion-gray-600">医師: ${doc.doctor}</p>` : ''}
                                        </div>
                                    `;
                                }).join('') : 
                                '<div class="text-center py-8 text-notion-gray-500">まだ書類作成履歴がありません</div>'
                            }
                        </div>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
        }

        function closeCustomerDetailModal() {
            document.getElementById('customerDetailModal').classList.add('hidden');
        }

        // 新規顧客追加フォーム処理
        document.getElementById('addCustomerForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const disabilityTypeMap = {
                'mental': '精神の障害',
                'physical': '肢体の障害',
                'visual': '眼の障害',
                'hearing': '聴覚・言語機能の障害',
                'respiratory': '呼吸器疾患の障害',
                'circulatory': '循環器疾患の障害',
                'kidney': '腎疾患・肝疾患・糖尿病の障害',
                'blood': '血液・造血器・その他の障害'
            };

            const newCustomer = {
                id: `CUST-2024-${String(customers.length + 1).padStart(3, '0')}`,
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value,
                address: document.getElementById('customerAddress').value,
                birthdate: document.getElementById('customerBirthdate').value,
                disabilityType: document.getElementById('customerDisabilityType').value,
                disabilityTypeName: disabilityTypeMap[document.getElementById('customerDisabilityType').value] || '',
                status: 'active',
                statusName: '進行中',
                registrationDate: new Date().toLocaleDateString('ja-JP'),
                notes: document.getElementById('customerNotes').value,
                documents: []
            };

            customers.push(newCustomer);
            filteredCustomers = [...customers];
            renderCustomers();
            closeAddCustomerModal();
            
            alert('新規顧客を追加しました。');
        });

        // ESCキーでモーダルを閉じる
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAddCustomerModal();
                closeCustomerDetailModal();
            }
        });

        // モーダル外クリックで閉じる
        document.getElementById('addCustomerModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAddCustomerModal();
            }
        });

        document.getElementById('customerDetailModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeCustomerDetailModal();
            }
        });

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            renderCustomers();
        });

        // 書類作成ページからのデータ連携用関数（グローバルに公開）
        window.addDocumentToCustomer = addDocumentToCustomer;
    </script>
</body>
</html>