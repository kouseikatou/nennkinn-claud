<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ çµ±åˆãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ« - éšœå®³å¹´é‡‘ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .log-entry {
            margin: 4px 0;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            word-break: break-all;
        }
        .log-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .log-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .log-info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .log-warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .log-debug { background-color: #e2e3e5; color: #383d41; border: 1px solid #d6d8db; }
        
        .json-viewer {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-connected { background-color: #28a745; }
        .status-disconnected { background-color: #dc3545; }
        .status-checking { background-color: #ffc107; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .tab-button {
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
            border-bottom: 2px solid #1d4ed8;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ”§ çµ±åˆãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
            <p class="text-gray-600">APIæ¥ç¶šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ãã—ã¦project-unified.htmlã®å•é¡Œã‚’åŒ…æ‹¬çš„ã«è¨ºæ–­ã—ã¾ã™</p>
        </div>

        <!-- æ¥ç¶šçŠ¶æ…‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span id="connectionStatus" class="status-indicator status-checking"></span>
                ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-gray-50 p-4 rounded">
                    <h3 class="font-medium text-gray-700 mb-2">APIã‚µãƒ¼ãƒãƒ¼</h3>
                    <p id="apiStatus" class="text-sm text-gray-600">ç¢ºèªä¸­...</p>
                </div>
                <div class="bg-gray-50 p-4 rounded">
                    <h3 class="font-medium text-gray-700 mb-2">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</h3>
                    <p id="dbStatus" class="text-sm text-gray-600">ç¢ºèªä¸­...</p>
                </div>
                <div class="bg-gray-50 p-4 rounded">
                    <h3 class="font-medium text-gray-700 mb-2">èªè¨¼çŠ¶æ…‹</h3>
                    <p id="authStatus" class="text-sm text-gray-600">ç¢ºèªä¸­...</p>
                </div>
                <div class="bg-gray-50 p-4 rounded">
                    <h3 class="font-medium text-gray-700 mb-2">project-unified</h3>
                    <p id="unifiedStatus" class="text-sm text-gray-600">ç¢ºèªä¸­...</p>
                </div>
            </div>
        </div>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8 px-6">
                    <button onclick="switchTab('api-test')" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 active">
                        ğŸš€ API ãƒ†ã‚¹ãƒˆ
                    </button>
                    <button onclick="switchTab('project-debug')" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        ğŸ› project-unified è¨ºæ–­
                    </button>
                    <button onclick="switchTab('console-monitor')" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        ğŸ“Š ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–
                    </button>
                    <button onclick="switchTab('network-monitor')" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–
                    </button>
                </nav>
            </div>
        </div>
        
        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„: API ãƒ†ã‚¹ãƒˆ -->
        <div id="api-test" class="tab-content active">
            <!-- APIè¨­å®š -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">ğŸ”§ APIè¨­å®š</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ™ãƒ¼ã‚¹URL</label>
                        <input type="text" id="baseUrl" value="https://nennkinn-claud.vercel.app/api" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³</label>
                        <input type="text" id="authToken" placeholder="Bearer tokenï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">âš¡ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <button onclick="testHealthCheck()" 
                            class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
                    </button>
                    <button onclick="testLogin()" 
                            class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ
                    </button>
                    <button onclick="testApplications()" 
                            class="bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        ç”³è«‹ãƒ‡ãƒ¼ã‚¿å–å¾—
                    </button>
                    <button onclick="testDatabaseConnection()" 
                            class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        DBæ¥ç¶šãƒ†ã‚¹ãƒˆ
                    </button>
                </div>
            </div>

            <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">ğŸ› ï¸ ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ¡ã‚½ãƒƒãƒ‰</label>
                        <select id="method" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</label>
                        <input type="text" id="endpoint" placeholder="/applications" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ï¼ˆJSONï¼‰</label>
                    <textarea id="requestBody" rows="4" placeholder='{"key": "value"}'
                              class="w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <button onclick="sendCustomRequest()" 
                        class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded transition-colors">
                    ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
                </button>
            </div>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„: project-unified è¨ºæ–­ -->
        <div id="project-debug" class="tab-content">
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">ğŸ› project-unified.html è¨ºæ–­</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <button onclick="testUnifiedPageLoad()" 
                            class="bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
                    </button>
                    <button onclick="testApplicationApiLoad()" 
                            class="bg-teal-500 hover:bg-teal-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        application-api.js ãƒã‚§ãƒƒã‚¯
                    </button>
                    <button onclick="simulateEditMode()" 
                            class="bg-pink-500 hover:bg-pink-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        ç·¨é›†ãƒ¢ãƒ¼ãƒ‰(?edit=1) æ¨¡æ“¬
                    </button>
                    <button onclick="testLocalStorageData()" 
                            class="bg-cyan-500 hover:bg-cyan-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¢ºèª
                    </button>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ†ã‚¹ãƒˆç”¨ç”³è«‹ID</label>
                    <input type="text" id="testApplicationId" value="1" placeholder="1" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦– -->
        <div id="console-monitor" class="tab-content">
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–</h2>
                <div class="mb-4">
                    <button onclick="toggleConsoleCapture()" id="consoleToggle"
                            class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded transition-colors mr-2">
                        ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–é–‹å§‹
                    </button>
                    <button onclick="clearConsoleLog()" 
                            class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¯ãƒªã‚¢
                    </button>
                </div>
                <div id="consoleOutput" class="bg-gray-900 text-green-400 p-4 rounded-md font-mono text-sm max-h-96 overflow-y-auto">
                    ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–å¾…æ©Ÿä¸­...
                </div>
            </div>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦– -->
        <div id="network-monitor" class="tab-content">
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆç›£è¦–</h2>
                <div class="mb-4">
                    <button onclick="toggleNetworkCapture()" id="networkToggle"
                            class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded transition-colors mr-2">
                        ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–é–‹å§‹
                    </button>
                    <button onclick="clearNetworkLog()" 
                            class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        ãƒ­ã‚°ã‚¯ãƒªã‚¢
                    </button>
                </div>
                <div id="networkOutput" class="bg-gray-50 p-4 rounded-md max-h-96 overflow-y-auto">
                    <div class="text-gray-500 text-sm">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–å¾…æ©Ÿä¸­...</div>
                </div>
            </div>
        </div>

        <!-- ãƒ­ã‚°è¡¨ç¤º -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">ğŸ“‹ çµ±åˆãƒ­ã‚°</h2>
                <div class="space-x-2">
                    <button onclick="exportLogs()" 
                            class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-1 px-3 rounded text-sm transition-colors">
                        ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                    </button>
                    <button onclick="clearLogs()" 
                            class="bg-red-500 hover:bg-red-600 text-white font-medium py-1 px-3 rounded text-sm transition-colors">
                        ã‚¯ãƒªã‚¢
                    </button>
                </div>
            </div>
            <div id="logContainer" class="bg-gray-50 p-4 rounded-md max-h-96 overflow-y-auto">
                <div class="log-entry log-info">çµ±åˆãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«ãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸ</div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let logs = [];
        let consoleCapturing = false;
        let networkCapturing = false;
        let originalConsole = {};
        let originalFetch = null;

        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
        function log(message, type = 'info', data = null) {
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const logEntry = {
                timestamp,
                message,
                type,
                data
            };
            logs.push(logEntry);
            
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            
            let content = `[${timestamp}] ${message}`;
            entry.textContent = content;
            
            if (data) {
                const dataView = document.createElement('div');
                dataView.className = 'json-viewer';
                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(data, null, 2);
                dataView.appendChild(pre);
                entry.appendChild(dataView);
            }
            
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            logs = [];
            document.getElementById('logContainer').innerHTML = 
                '<div class="log-entry log-info">ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>';
        }

        function exportLogs() {
            const logText = logs.map(log => 
                `[${log.timestamp}] [${log.type.toUpperCase()}] ${log.message}${log.data ? '\n' + JSON.stringify(log.data, null, 2) : ''}`
            ).join('\n\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `debug-${new Date().toISOString()}.log`;
            a.click();
        }

        // æ¥ç¶šçŠ¶æ…‹ã‚’æ›´æ–°
        function updateConnectionStatus(status) {
            const indicator = document.getElementById('connectionStatus');
            indicator.className = `status-indicator status-${status}`;
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            // å…¨ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // å…¨ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
            document.getElementById(tabName).classList.add('active');
            
            // å¯¾å¿œã™ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
            event.target.classList.add('active');
        }

        // APIå‘¼ã³å‡ºã—é–¢æ•°
        async function makeRequest(method, endpoint, body = null) {
            const baseUrl = document.getElementById('baseUrl').value;
            const authToken = document.getElementById('authToken').value;
            
            const url = `${baseUrl}${endpoint}`;
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            if (authToken) {
                options.headers['Authorization'] = authToken.startsWith('Bearer ') ? authToken : `Bearer ${authToken}`;
            }

            if (body && method !== 'GET') {
                options.body = JSON.stringify(body);
            }

            log(`ğŸš€ ${method} ${url}`, 'info');
            
            try {
                const response = await fetch(url, options);
                const responseText = await response.text();
                
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                } catch {
                    responseData = responseText;
                }

                if (response.ok) {
                    log(`âœ… ${response.status} - æˆåŠŸ`, 'success', responseData);
                    updateConnectionStatus('connected');
                } else {
                    log(`âŒ ${response.status} ${response.statusText} - å¤±æ•—`, 'error', responseData);
                    updateConnectionStatus('disconnected');
                }

                return { response, data: responseData };
            } catch (error) {
                log(`ğŸ’¥ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateConnectionStatus('disconnected');
                return { error };
            }
        }

        // åŸºæœ¬ãƒ†ã‚¹ãƒˆé–¢æ•°
        async function testHealthCheck() {
            log('ğŸ¥ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­...', 'info');
            updateConnectionStatus('checking');
            
            const result = await makeRequest('GET', '/health');
            if (result.data) {
                document.getElementById('apiStatus').textContent = 'æ­£å¸¸å‹•ä½œä¸­';
            } else {
                document.getElementById('apiStatus').textContent = 'æ¥ç¶šå¤±æ•—';
            }
        }

        async function testLogin() {
            log('ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...', 'info');
            const credentials = {
                email: 'admin@disability-pension.jp',
                password: 'admin123'
            };
            const result = await makeRequest('POST', '/auth/login', credentials);
            
            if (result.data && result.data.token) {
                document.getElementById('authToken').value = result.data.token;
                document.getElementById('authStatus').textContent = 'ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½';
                log('ğŸ‰ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è‡ªå‹•è¨­å®šã—ã¾ã—ãŸ', 'success');
            } else {
                document.getElementById('authStatus').textContent = 'èªè¨¼ã‚¨ãƒ©ãƒ¼';
            }
        }

        async function testApplications() {
            log('ğŸ“‹ ç”³è«‹ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...', 'info');
            const result = await makeRequest('GET', '/applications?limit=3');
            
            if (result.data && result.data.applications) {
                document.getElementById('dbStatus').textContent = `æ¥ç¶šæ¸ˆã¿ (${result.data.applications.length}ä»¶)`;
            } else {
                document.getElementById('dbStatus').textContent = 'æ¥ç¶šã‚¨ãƒ©ãƒ¼';
            }
        }

        async function testDatabaseConnection() {
            log('ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆä¸­...', 'info');
            
            try {
                // ApplicationAPIãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
                if (typeof ApplicationAPI !== 'undefined') {
                    const result = await ApplicationAPI.getApplications({ limit: 1 });
                    log('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæˆåŠŸ', 'success', result);
                    document.getElementById('dbStatus').textContent = 'æ¥ç¶šæ¸ˆã¿';
                } else {
                    // APIçµŒç”±ã§ãƒ†ã‚¹ãƒˆ
                    await testApplications();
                }
            } catch (error) {
                log(`âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error', error);
                document.getElementById('dbStatus').textContent = 'æ¥ç¶šã‚¨ãƒ©ãƒ¼';
            }
        }

        async function sendCustomRequest() {
            const method = document.getElementById('method').value;
            const endpoint = document.getElementById('endpoint').value;
            const bodyText = document.getElementById('requestBody').value;

            let body = null;
            if (bodyText.trim()) {
                try {
                    body = JSON.parse(bodyText);
                } catch (error) {
                    log(`âŒ JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    return;
                }
            }

            await makeRequest(method, endpoint, body);
        }

        // project-unified è¨ºæ–­é–¢æ•°
        async function testUnifiedPageLoad() {
            log('ğŸ” project-unified.html ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                const response = await fetch('/project-unified.html');
                if (response.ok) {
                    const html = await response.text();
                    log('âœ… project-unified.html èª­ã¿è¾¼ã¿æˆåŠŸ', 'success');
                    
                    // JavaScriptä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯
                    if (html.includes('js/application-api.js')) {
                        log('ğŸ“ application-api.js ã®ä¾å­˜é–¢ä¿‚ã‚’ç¢ºèª', 'info');
                        await testApplicationApiLoad();
                    }
                    
                    document.getElementById('unifiedStatus').textContent = 'ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æˆåŠŸ';
                } else {
                    log(`âŒ project-unified.html èª­ã¿è¾¼ã¿å¤±æ•—: ${response.status}`, 'error');
                    document.getElementById('unifiedStatus').textContent = 'èª­ã¿è¾¼ã¿å¤±æ•—';
                }
            } catch (error) {
                log(`ğŸ’¥ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                document.getElementById('unifiedStatus').textContent = 'æ¥ç¶šã‚¨ãƒ©ãƒ¼';
            }
        }

        async function testApplicationApiLoad() {
            log('ğŸ”§ application-api.js ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                const response = await fetch('/js/application-api.js');
                if (response.ok) {
                    const jsCode = await response.text();
                    log('âœ… application-api.js ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª', 'success');
                    
                    // APIãƒ™ãƒ¼ã‚¹URLè¨­å®šã‚’ãƒã‚§ãƒƒã‚¯
                    if (jsCode.includes('getAPIBaseURL')) {
                        log('ğŸ“ APIè¨­å®šé–¢æ•°ã‚’ç¢ºèª', 'debug');
                    }
                    
                    // ApplicationAPIã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å­˜åœ¨ç¢ºèª
                    if (typeof ApplicationAPI !== 'undefined') {
                        log('âœ… ApplicationAPI ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒåˆ©ç”¨å¯èƒ½', 'success');
                    } else {
                        log('âš ï¸ ApplicationAPI ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæœªèª­ã¿è¾¼ã¿', 'warning');
                    }
                } else {
                    log(`âŒ application-api.js èª­ã¿è¾¼ã¿å¤±æ•—: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`ğŸ’¥ application-api.js èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        async function simulateEditMode() {
            log('ğŸ­ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰(?edit=1) æ¨¡æ“¬ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            const applicationId = document.getElementById('testApplicationId').value || '1';
            
            try {
                // ç”³è«‹ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãƒ†ã‚¹ãƒˆ
                log(`ğŸ“Š ç”³è«‹ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ (ID: ${applicationId})`, 'info');
                const result = await makeRequest('GET', `/applications/${applicationId}`);
                
                if (result.data) {
                    log('âœ… ç”³è«‹ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ', 'success', result.data);
                    document.getElementById('unifiedStatus').textContent = 'ç·¨é›†ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ';
                    
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®ä¿å­˜ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                    localStorage.setItem(`application_${applicationId}`, JSON.stringify(result.data));
                    log('ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã—ã¾ã—ãŸ', 'info');
                } else {
                    log('âŒ ç”³è«‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    document.getElementById('unifiedStatus').textContent = 'ãƒ‡ãƒ¼ã‚¿ä¸æ˜';
                }
            } catch (error) {
                log(`ğŸ’¥ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ¨¡æ“¬ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                document.getElementById('unifiedStatus').textContent = 'ã‚¨ãƒ©ãƒ¼';
            }
        }

        async function testLocalStorageData() {
            log('ğŸ—„ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ç¢ºèª', 'info');
            
            const applicationId = document.getElementById('testApplicationId').value || '1';
            const storageKey = `application_${applicationId}`;
            const storedData = localStorage.getItem(storageKey);
            
            if (storedData) {
                try {
                    const parsedData = JSON.parse(storedData);
                    log(`âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ç™ºè¦‹ (${storageKey})`, 'success', parsedData);
                } catch (error) {
                    log(`âŒ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            } else {
                log(`âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¾ã›ã‚“ (${storageKey})`, 'warning');
                
                // å…¨ã¦ã®ã‚­ãƒ¼ã‚’èª¿æŸ»
                const allKeys = Object.keys(localStorage);
                if (allKeys.length > 0) {
                    log(`ğŸ“‹ å­˜åœ¨ã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼:`, 'info', allKeys);
                } else {
                    log('ğŸ“‹ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯ç©ºã§ã™', 'info');
                }
            }
        }

        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–æ©Ÿèƒ½
        function toggleConsoleCapture() {
            const button = document.getElementById('consoleToggle');
            const output = document.getElementById('consoleOutput');
            
            if (!consoleCapturing) {
                // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–é–‹å§‹
                originalConsole.log = console.log;
                originalConsole.error = console.error;
                originalConsole.warn = console.warn;
                originalConsole.info = console.info;
                
                console.log = function(...args) {
                    originalConsole.log.apply(console, args);
                    appendConsoleLog('LOG', args.join(' '), '#4ade80');
                };
                
                console.error = function(...args) {
                    originalConsole.error.apply(console, args);
                    appendConsoleLog('ERROR', args.join(' '), '#ef4444');
                };
                
                console.warn = function(...args) {
                    originalConsole.warn.apply(console, args);
                    appendConsoleLog('WARN', args.join(' '), '#f59e0b');
                };
                
                console.info = function(...args) {
                    originalConsole.info.apply(console, args);
                    appendConsoleLog('INFO', args.join(' '), '#3b82f6');
                };
                
                consoleCapturing = true;
                button.textContent = 'ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–åœæ­¢';
                button.className = button.className.replace('bg-green-500', 'bg-red-500').replace('hover:bg-green-600', 'hover:bg-red-600');
                output.innerHTML = '<div style="color: #4ade80;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–é–‹å§‹...</div>';
                
                log('ğŸ“Š ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–ã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'info');
            } else {
                // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–åœæ­¢
                console.log = originalConsole.log;
                console.error = originalConsole.error;
                console.warn = originalConsole.warn;
                console.info = originalConsole.info;
                
                consoleCapturing = false;
                button.textContent = 'ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–é–‹å§‹';
                button.className = button.className.replace('bg-red-500', 'bg-green-500').replace('hover:bg-red-600', 'hover:bg-green-600');
                
                log('ğŸ“Š ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–ã‚’åœæ­¢ã—ã¾ã—ãŸ', 'info');
            }
        }
        
        function appendConsoleLog(level, message, color) {
            const output = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const div = document.createElement('div');
            div.style.color = color;
            div.textContent = `[${timestamp}] [${level}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }
        
        function clearConsoleLog() {
            document.getElementById('consoleOutput').innerHTML = 'ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç›£è¦–å¾…æ©Ÿä¸­...';
        }

        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–æ©Ÿèƒ½
        function toggleNetworkCapture() {
            const button = document.getElementById('networkToggle');
            const output = document.getElementById('networkOutput');
            
            if (!networkCapturing) {
                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–é–‹å§‹
                originalFetch = window.fetch;
                
                window.fetch = async function(...args) {
                    const startTime = Date.now();
                    const url = args[0];
                    const options = args[1] || {};
                    
                    appendNetworkLog(`ğŸš€ ${options.method || 'GET'} ${url}`, '#3b82f6');
                    
                    try {
                        const response = await originalFetch.apply(this, args);
                        const duration = Date.now() - startTime;
                        const status = response.status;
                        const color = status >= 200 && status < 300 ? '#4ade80' : '#ef4444';
                        
                        appendNetworkLog(`${status >= 200 && status < 300 ? 'âœ…' : 'âŒ'} ${status} ${url} (${duration}ms)`, color);
                        
                        return response;
                    } catch (error) {
                        const duration = Date.now() - startTime;
                        appendNetworkLog(`ğŸ’¥ ERROR ${url} (${duration}ms): ${error.message}`, '#ef4444');
                        throw error;
                    }
                };
                
                networkCapturing = true;
                button.textContent = 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–åœæ­¢';
                button.className = button.className.replace('bg-blue-500', 'bg-red-500').replace('hover:bg-blue-600', 'hover:bg-red-600');
                output.innerHTML = '<div class="text-blue-500 text-sm">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–é–‹å§‹...</div>';
                
                log('ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–ã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'info');
            } else {
                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–åœæ­¢
                if (originalFetch) {
                    window.fetch = originalFetch;
                }
                
                networkCapturing = false;
                button.textContent = 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–é–‹å§‹';
                button.className = button.className.replace('bg-red-500', 'bg-blue-500').replace('hover:bg-red-600', 'hover:bg-blue-600');
                
                log('ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–ã‚’åœæ­¢ã—ã¾ã—ãŸ', 'info');
            }
        }
        
        function appendNetworkLog(message, color) {
            const output = document.getElementById('networkOutput');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const div = document.createElement('div');
            div.className = 'text-sm py-1';
            div.style.color = color;
            div.textContent = `[${timestamp}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }
        
        function clearNetworkLog() {
            document.getElementById('networkOutput').innerHTML = '<div class="text-gray-500 text-sm">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–å¾…æ©Ÿä¸­...</div>';
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            log('ğŸ”§ çµ±åˆãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–ä¸­...', 'info');
            
            // è‡ªå‹•çš„ã«ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
            await testHealthCheck();
            
            // ApplicationAPIã®çŠ¶æ…‹ã‚’ç¢ºèª
            if (typeof ApplicationAPI !== 'undefined') {
                log('âœ… ApplicationAPIãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success');
            } else {
                log('âš ï¸ ApplicationAPIãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'warning');
                log('ğŸ’¡ js/application-api.jsãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„', 'info');
            }
            
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            window.addEventListener('error', function(event) {
                log(`ğŸ› JavaScriptã‚¨ãƒ©ãƒ¼: ${event.message}`, 'error', {
                    filename: event.filename,
                    line: event.lineno,
                    column: event.colno,
                    error: event.error?.stack
                });
            });
            
            // Enter ã‚­ãƒ¼ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
            document.getElementById('endpoint').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendCustomRequest();
                }
            });
            
            log('âœ… çµ±åˆãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«ã®åˆæœŸåŒ–å®Œäº†', 'success');
        });
    </script>
</body>
</html>